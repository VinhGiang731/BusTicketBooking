<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Blue Sky Travel</title>
    <link rel="stylesheet" th:href="@{/css/admin/adminstyle.css}" />
  </head>
  <body>
    <div class="admin-container">
      <div class="sidebar">
        <h2>üöå Admin BTB</h2>
        <ul>
          <li><a href="#" onclick="loadContent('dashboard.html')">T·ªïng quan</a></li>
          <li><a href="#" onclick="loadContent('busmanagement.html')">Qu·∫£n l√Ω chuy·∫øn xe</a></li>
          <li><a href="#" onclick="loadContent('ticketmanagement.html')">Qu·∫£n l√Ω v√©</a></li>
          <li><a href="#" onclick="loadContent('usermanagement.html')">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
          <li><a href="#">Th·ªëng k√™</a></li>
        </ul>
      </div>

      <div class="main-content">
        <div class="top-bar">
          <div class="profile-menu" onclick="toggleProfileDropdown()">
            <img src="https://i.ibb.co/4Z8Yz3B/user.png" alt="Admin Avatar" class="avatar" />
            <span class="admin-name">Admin</span>
            <div class="dropdown" id="profileDropdown">
              <p><strong>T√†i kho·∫£n:</strong> admin</p>
              <p><strong>Email:</strong> admin@bluesky.vn</p>
              <hr />
              <button class="btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
            </div>
          </div>
        </div>

        <div id="dynamic-content"></div>
      </div>
    </div>

    <script>
    // ‚úÖ N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p th√¨ chuy·ªÉn sang login
    if (!localStorage.getItem("isLoggedIn")) {
      window.location.href = "login.html";
    }

    function toggleProfileDropdown() {
      const dropdown = document.getElementById("profileDropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    }

    window.addEventListener("click", function (e) {
      const menu = document.querySelector(".profile-menu");
      const dropdown = document.getElementById("profileDropdown");
      if (!menu.contains(e.target)) {
        dropdown.style.display = "none";
      }
    });

    function loadContent(viewPath) {
      fetch(viewPath)
        .then(res => res.text())
        .then(html => {
          document.getElementById("dynamic-content").innerHTML = html;

          // ‚úÖ G·ª° script ƒë·ªông c≈© n·∫øu c√≥
          const oldScript = document.getElementById("dynamic-script");
          if (oldScript) {
            oldScript.remove();
          }

          // ‚úÖ G·∫Øn script t∆∞∆°ng ·ª©ng n·∫øu l√† trang c√≥ logic ri√™ng
          if (viewPath === "usermanagement.html") {
            const script = document.createElement("script");
            script.src = "assets/js/usermanagement.js";
            script.id = "dynamic-script";
            document.body.appendChild(script);
          }

          // B·∫°n c√≥ th·ªÉ m·ªü r·ªông cho c√°c view kh√°c t∆∞∆°ng t·ª±:
          // if (viewPath === "busmanagement.html") { ... }
        })
        .catch(err => {
          document.getElementById("dynamic-content").innerHTML = "<p>L·ªói khi t·∫£i n·ªôi dung!</p>";
          console.error(err);
        });
    }

    function logout() {
      localStorage.removeItem("isLoggedIn");
      window.location.href = "login.html";
    }

    // ‚úÖ M·∫∑c ƒë·ªãnh load dashboard khi v√†o admin
    window.onload = () => loadContent('dashboard.html');
  </script>
  </body>
</html>
